<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bitácora de Actividades Diarias</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* Evita el desplazamiento horizontal y asegura que el body ocupe el 100% del viewport */
        body, html {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden; /* Oculta el desplazamiento horizontal */
        }

        /* Header */
        .header {
            background-color: #007BFF;
            color: white;
            text-align: center;
            padding: 15px;
            width: 100%;
            font-size: 1.5em;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            box-sizing: border-box; /* Asegura que el padding no exceda el ancho */
        }

        /* Contenedor del formulario */
        .container {
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            text-align: center;
            margin: 40px auto;
            grid-row: 2;
            height: auto;
            box-sizing: border-box; /* Incluye el padding en el ancho total */
        }

        h1 {
            text-align: center;
            color: #333;
            margin: 0 0 20px 0; /* Ajusta el margen inferior */
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }

        input[type="date"],
        input[type="time"],
        input[type="text"],
        textarea,
        select,
        #oficina,
        button {
            width: 100%;
            margin-top: 5px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; /* Incluye el padding en el ancho total */
        }

        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            padding: 12px 0;
        }

        button:hover {
            background-color: #0056b3;
        }

        /* Estilo para el botón "Volver al Inicio" */
        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            text-align: center;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.3s;
            position: fixed;
            top: 80px;
            left: 0px;
            z-index: 1001;
            box-sizing: border-box; /* Incluye el padding en el ancho total */
        }

        .back-button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }

        /* Estilo para los contenedores de preguntas */
        .question-container {
            margin-bottom: 20px;
            text-align: left;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            transition: border-color 0.3s;
            box-sizing: border-box; /* Incluye el padding en el ancho total */
        }

        .question-container:hover {
            border-color: #007BFF;
        }

        .question-container input[type="date"],
        .question-container input[type="time"],
        .question-container input[type="text"],
        .question-container textarea,
        .question-container select {
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            width: 100%;
            font-size: 16px;
            background-color: #f9f9f9;
            color: #333;
            transition: border-color 0.3s;
            box-sizing: border-box; /* Incluye el padding en el ancho total */
            margin-top: 5px;
        }

        .question-container input[type="date"]:focus,
        .question-container input[type="time"]:focus,
        .question-container input[type="text"]:focus,
        .question-container textarea:focus,
        .question-container select:focus {
            border-color: #007BFF;
            outline: none;
        }

        /* Estilo del overlay (pantalla bloqueada) */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        #loadingMessage {
            color: white;
            font-size: 24px;
            font-family: 'Times New Roman', Times, serif;
            text-align: center;
            padding: 20px;
        }

        /* Estilo para Mensajes */
        .swal-actions {
            display: flex; /* Coloca los botones en una fila */
            justify-content: center; /* Centra los botones horizontalmente */
            gap: 10px; /* Espacio entre los botones */
            width: 80%; /* Limita el ancho del contenedor al 80% del modal */
            margin: 0 auto; /* Centra el contenedor horizontalmente */
            flex-wrap: nowrap; /* Evita que los botones se apilen en dos filas */
        }

        /* Estilo personalizado para el contenido del mensaje */
        .swal-content {
            font-size: 0.9em;  /* Reduce el tamaño del texto */
            line-height: 1.4;  /* Ajusta el espaciado entre líneas */
        }

        .swal2-html-container {
            margin-bottom: 15px;
        }

        /* Estilo personalizado para ambos botones */
        .swal-button,
        .swal-button-cancel {
            flex: 1; /* Hace que ambos botones ocupen el mismo espacio */
            min-width: 120px; /* Ancho mínimo para ambos botones */
            padding: 10px 20px; /* Espaciado interno */
            font-size: 14px; /* Tamaño de fuente */
            text-align: center; /* Centra el texto dentro del botón */
            border: none; /* Elimina el borde predeterminado */
            border-radius: 4px; /* Bordes redondeados */
            color: white; /* Texto en blanco */
            transition: background-color 0.3s ease; /* Transición suave para el hover */
        }

    /* Estilo personalizado para el popup/modal */
    .swal-popup {
        width: 300px;  /* Ajusta el ancho máximo del modal */
        max-width: 90%;  /* Permite que el modal sea flexible en pantallas pequeñas */
    }

        /* Opcional: colores específicos para cada botón */
        .swal-button {
            background-color: #28a745;  /* Verde para el botón de "Sí" */
            color: white;  /* Texto en blanco */
            border: none;
            border-radius: 4px;
        }

        .swal-button-cancel {
            background-color: #FF6347 ;  /* Rojo para el botón de "No" */
            color: white;  /* Texto oscuro */
            border: none;
            border-radius: 4px;
        }

        .swal2-actions {
            display: flex !important;  /* Asegura que los botones estén en una fila */
            justify-content: center;   /* Centra los botones horizontalmente */
            gap: 10px;                 /* Agrega espacio entre los botones */
            flex-wrap: nowrap;         /* Evita que los botones se apilen en dos filas */
        }

        /* Eliminar el borde negro del ícono personalizado */
        .swal2-icon.swal2-icon-show {
            background-color: transparent !important; /* Fondo transparente */
        }

        .no-border-icon {
            border: none !important; /* Elimina el borde circular */
            background-color: transparent !important; /* Fondo transparente */
        }

        /* Estilo para Botones, Habilitar/Deshabilitar */
        #enviarBtn {
            background-color: #007bff; /* Color azul */
            color: white;
            border: none;
            cursor: pointer;
            padding: 12px 0;
            font-size: 16px;
            border-radius: 5px;
            transition: background-color 0.3s ease, opacity 0.3s ease;
        }

        /* Estilo para el botón de enviar cuando está deshabilitado */
        #enviarBtn:disabled {
            background-color: #ccc; /* Color gris */
            color: #666666; /* Texto gris oscuro */
            cursor: not-allowed; /* Cambia el cursor a "no permitido" */
            opacity: 0.7; /* Reduce la opacidad para dar un aspecto deshabilitado */
        }

        /* Efecto hover solo cuando el botón está habilitado */
        #enviarBtn:not(:disabled):hover {
            background-color: #0056b3; /* Color azul más oscuro al pasar el mouse */
        }

        /* Estilo para Botones, Misma Linea */
        .botones-container {
            display: flex; /* Hace que los botones estén en la misma línea */
            justify-content: space-between; /* Espacio entre los botones */
            gap: 10px; /* Espacio entre los botones */
            margin-top: 20px; /* Margen superior para separar del contenido anterior */
        }

        /* Estilo para los botones dentro del contenedor */
        .botones-container button {
            flex: 1; /* Hace que los botones ocupen el espacio disponible */
            margin: 0; /* Elimina el margen predeterminado */
        }

        /* Estilo para el botón Reiniciar */
        #reiniciarBtn {
            background-color: #6c757d; /* Color gris */
            color: white;
            border: none;
            cursor: pointer;
            padding: 12px 0;
            font-size: 16px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            display: none; /* Oculto por defecto */
        }

        #reiniciarBtn:hover {
            background-color: #5a6268; /* Color gris más oscuro al pasar el mouse */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }

/* Centrar los encabezados de la tabla */
#tablaActividades th {
    text-align: center;
}

/* Centrar las celdas de las columnas Frecuencia y Realizada */
#tablaActividades td:nth-child(2),
#tablaActividades td:nth-child(3) {
    text-align: center;
}

/* Centrar los checkboxes en la columna Realizada */
#tablaActividades td:nth-child(3) input[type="checkbox"] {
    margin: 0 auto;
    display: block;
}


/* Color para filas con frecuencia Diario */
.fila-diario {
    background-color: #A6D5FA; /* Azul pastel más bonito */
}

/* Color para filas con frecuencia Semanal */
.fila-semanal {
    background-color: #FFC0CB; /* Lila pastel más bonito */
}

/* Estilo para la simbología */
.simbologia {
    margin-bottom: 10px;
    font-size: 14px;
    display: flex;
    gap: 10px;
}

.simbologia div {
    padding: 5px 10px;
    border-radius: 5px;
}

/* Estilo para la simbología */
.simbologia .diario {
    background-color: #A6D5FA; /* Azul pastel */
}

.simbologia .semanal {
    background-color: #FFC0CB; /* Lila pastel */
}

/* Ocultar la columna de Frecuencia */
#tablaActividades th:nth-child(2),
#tablaActividades td:nth-child(2) {
    display: none;
}

/* Estilo para hacer los checkboxes más grandes */
#tablaActividades input[type="checkbox"] {
    width: 20px;       /* Ancho del checkbox */
    height: 20px;      /* Alto del checkbox */
    transform: scale(1.5); /* Escala el checkbox para hacerlo más grande */
    margin: 0 auto;    /* Centra el checkbox en la celda */
    display: block;    /* Asegura que el margen auto funcione */
    cursor: pointer;   /* Cambia el cursor al pasar sobre el checkbox */
}

/* Opcional: estilo para cuando el checkbox está marcado */
#tablaActividades input[type="checkbox"]:checked {
    background-color: #007BFF; /* Color de fondo cuando está marcado */
}






    </style>
</head>
<body>
    <div class="header">
        Pisos Brillantes
    </div>
    <a href="javascript:void(0);" class="back-button" onclick="goBack()">Volver al Inicio</a>
    <div class="container">
        <h1>Bitácora de Actividades Diarias</h1>
        <div class="form-container">
            <form id="bitacoraForm">
                <div class="question-container">
                    <label for="fecha">Fecha:</label>
                    <input type="date" id="fecha" name="fecha" required>
                </div>

                <div class="question-container">
                    <label for="tipo">Tipo de Actividad:</label>
                    <select id="tipo" name="tipo" required onchange="mostrarCampos()">
                        <option value="">Selecciona una opción</option>
                        <option value="Área">Área</option>
                        <option value="Baño">Baño</option>
                    </select>
                </div>

                <div class="question-container" id="areaContainer" style="display: none;">
                    <label for="area">Área:</label>
                    <select id="area" name="area">
                        <option value="">Selecciona una opción</option>
                        <option value="Administración">Administración</option>
                        <option value="Almacén General">Almacén General</option>
                        <option value="Bodega de Limpieza">Bodega de Limpieza</option>
                        <option value="Chiminike">Chiminike</option>
                        <option value="Despacho">Despacho</option>
                        <option value="Enfermería">Enfermería</option>
                        <option value="Equipo Móvil">Equipo Móvil</option>
                        <option value="Expedición">Expedición</option>
                        <option value="Laboratorio de Calidad">Laboratorio de Calidad</option>
                        <option value="Laboratorio de Concreto">Laboratorio de Concreto</option>
                        <option value="Machaqueo A">Machaqueo A</option>
                        <option value="Posta Principal">Posta Principal</option>
                        <option value="Sala de Control">Sala de Control</option>
                        <option value="Sala de Maternidad">Sala de Maternidad</option>
                        <option value="Salón Vial">Salón Vial</option>
                        <option value="Taller Eléctrico">Taller Eléctrico</option>
                    </select>
                </div>

<div class="question-container" id="oficinaContainer" style="display: none;">
    <label for="oficina">Oficina:</label>
    <select id="oficina" name="oficina">
        <option value="">Selecciona una opción</option>
        <option value="Sección #1">Sección #1</option>
        <option value="Sección #2">Sección #2</option>
    </select>
</div>

                <div class="question-container" id="bañoContainer" style="display: none;">
                    <label for="baño">Baños de:</label>
                    <select id="baño" name="baño">
                        <option value="">Selecciona una opción</option>
                        <option value="Admin - Gerencia">Admin - Gerencia</option>
                        <option value="Admin - Hombres">Admin - Hombres</option>
                        <option value="Admin - Mujeres">Admin - Mujeres</option>
                        <option value="Admin - Sala de Reuniones">Admin - Sala de Reuniones</option>
                        <option value="Almacen General">Almacen General</option>
                        <option value="Camerinos Contratistas">Camerinos Contratistas</option>
                        <option value="Camerinos Permanentes">Camerinos Permanentes</option>
                        <option value="Despacho">Despacho</option>
                        <option value="Enfermería">Enfermería</option>
                        <option value="Expedición">Expedición</option>
                        <option value="Laboratorio de Calidad">Laboratorio de Calidad</option>
                        <option value="Laboratorio de Concreto">Laboratorio de Concreto</option>
                        <option value="Machaqueo A">Machaqueo A</option>
                        <option value="Posta Guardias">Posta Guardias</option>
                        <option value="Posta Recepción">Posta Recepción</option>
                        <option value="Sala de Control">Sala de Control</option>
                        <option value="Salón Vial">Salón Vial</option>
                        <option value="Taller Electrico">Taller Electrico</option>
                        <option value="Transportistas">Transportistas</option>
                    </select>
                </div>

                <div class="simbologia">
                    <div class="diario">Diario</div>
                    <div class="semanal">Semanal</div>
                </div>

                <table id="tablaActividades">
                    <thead>
                        <tr>
                            <th>Actividad</th>
                            <th>Frecuencia</th>
                            <th>Realizada</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Las actividades se generarán automáticamente aquí -->
                    </tbody>
                </table>

                <div class="botones-container">
                    <button type="button" id="reiniciarBtn" onclick="reiniciarFormulario()">Reiniciar</button>
                    <button type="button" id="enviarBtn" disabled onclick="confirmarEnvio()">Enviar</button>
                </div>
            </form>

            <!-- Contenedor para bloquear la pantalla -->
            <div id="overlay" style="display: none;">
                <div id="loadingMessage">
                    <p>Procesando...🥱</p>
                </div>
            </div>
        </div>
    </div>

<script>
    // Función para volver al inicio
    function goBack() {
        window.location.href = "Bitácoras.html";
    }

    // Precargar la fecha actual
    function prellenarFechaHora() {
        let today = new Date();
        let year = today.getFullYear();
        let month = String(today.getMonth() + 1).padStart(2, "0");
        let day = String(today.getDate()).padStart(2, "0");
        document.getElementById("fecha").value = `${year}-${month}-${day}`;
    }

    // Llamar a la función para precargar la fecha al cargar la página
    prellenarFechaHora();

    // Arreglo COMPLETO de actividades para Áreas (sin omitir ninguna)
    const actividadesArea = [
        { descripcion: "Sacudir o aspirar el polvo de los muebles y las estanterías en las áreas designadas.", frecuencia: "Diario" },
        { descripcion: "Limpiar y desinfectar todas las superficies de trabajo, incluyendo escritorios, mesas, estantes, archiveros y mostradores.", frecuencia: "Diario" },
        { descripcion: "Limpiar y desinfectar los teléfonos, teclados, mouse y otros dispositivos electrónicos compartidos.", frecuencia: "Diario" },
        { descripcion: "Limpiar y desinfectar todas las superficies de contacto frecuente, como manijas de puertas, interruptores de luz y pasamanos.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfeccion de los oasis. Limpiar toda la superficie exterior con un paño desinfectante o toallitas adecuadas para eliminar gérmenes y mantener un entorno de trabajo saludable.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfeccion de los microondas. Limpiar la superficie exterior e interior, con un paño desinfectante o toallitas adecuadas para eliminar gérmenes y mantener un entorno de trabajo saludable.", frecuencia: "Diario" },
        { descripcion: "Limpieza y lavado de las percoladoras, desmontar las piezas removibles y lavarlas con agua y jabón, asegurándose de enjuagarlas bien. Limpia la superficie exterior con un paño desinfectante para mantener la higiene.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfección de las refrigeradoras, limpiar tanto por dentro como por fuera, incluyendo estantes y cajones, usando un paño desinfectante para mantener un entorno seguro para los alimentos.", frecuencia: "Diario" },
        { descripcion: "Barrer o mopear el suelo en toda el área designada para eliminar el polvo y la suciedad.", frecuencia: "Diario" },
        { descripcion: "Recolectar la basura de todos los basureros, asegurandose de reemplazar las bolsas de basura por nuevas.", frecuencia: "Diario" },
        { descripcion: "Reponer los suministros de papel higiénico, toallas de papel, jabón y otros suministros necesarios.", frecuencia: "Diario" },
        { descripcion: "Trapear el suelo en toda el área designada utilizando desinfectante, asegurando una limpieza más profunda y desinfección.", frecuencia: "Diario" },
        { descripcion: "Aplicar un aromatizante en el área designada después de haber terminado la limpieza para mantener un ambiente fresco y agradable.", frecuencia: "Diario" },
        { descripcion: "Limpiar las telas de araña y el polvo acumulado en las esquinas y techos utilizando un escobillón para alcanzar las áreas altas de manera efectiva.", frecuencia: "Semanal" },
        { descripcion: "Realizar un lavado profundo del oasis, de esta manera garantizar la calidad del agua que se dispensa y mantener el funcionamiento óptimo del equipo.", frecuencia: "Semanal" },
        { descripcion: "Eliminar las partículas de polvo en los diferentes vidrios con un paño de microfibra color café. Aplicar limpiador de vidrio con un paño de microfibra azul para obtener un acabado brillante y sin rayas.", frecuencia: "Semanal" },
        { descripcion: "Limpiar y aplicar abrillantador en las patas de las sillas usando un paño de microfibra color cafe para eliminar la suciedad y el polvo acumulado, y de esta manera dejarlas con un acabado brillante.", frecuencia: "Semanal" },
        { descripcion: "Lavar las piletas de alrededores de las áreas.", frecuencia: "Semanal" },
        { descripcion: "Lavar las papeleras de basura de las oficinas. Utilizar detergente y agua para lavar tanto el interior como el exterior de las papeleras, asegurándose de eliminar los gérmenes y olores no deseados.", frecuencia: "Semanal" }
    ];

    // Arreglo COMPLETO de actividades para Baños (sin omitir ninguna)
    const actividadesBaño = [
        { descripcion: "Recolectar la basura de todos los basureros, asegurándose de reemplazar las bolsas de basura por nuevas.", frecuencia: "Diario" },
        { descripcion: "Barrer o mopear el suelo en toda el área designada para eliminar el polvo y la suciedad.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfección de los urinarios presentes.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfección de los sanitarios presentes.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfección de las duchas presentes.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfección de los lavamanos presentes.", frecuencia: "Diario" },
        { descripcion: "Revisar que no haya daños o problemas de funcionamiento en los baños, y en caso que aplique reportar al supervisor.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfección de todas las superficies de contacto frecuente, como manijas de puertas, interruptores de luz y pasamanos.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfección de los recubrimientos como azulejos aplicando una solución concentrada de cloro al 0.2% y secar con una toalla de microfibra color amarillo.", frecuencia: "Diario" },
        { descripcion: "Aplicar el limpiador y pulidor de acero inoxidable, con una toalla de microfibra color café en las superficies de acero inoxidable presentes en el área.", frecuencia: "Diario" },
        { descripcion: "Aplicar limpiador de vidrio en los espejos con un paño de microfibra color azul para obtener un acabado brillante y sin rayas.", frecuencia: "Diario" },
        { descripcion: "Reponer los suministros de papel higiénico, toallas de papel, jabón y otros suministros necesarios.", frecuencia: "Diario" },
        { descripcion: "Revisar el estado de funcionamiento de los diferentes dispensadores que estén presentes, y en caso de daño reportar al supervisor.", frecuencia: "Diario" },
        { descripcion: "Trapear el suelo en toda el área designada utilizando desinfectante, asegurando una limpieza más profunda y desinfección.", frecuencia: "Diario" },
        { descripcion: "Aplicar un aromatizante en el área designada después de haber terminado la limpieza para mantener un ambiente fresco y agradable.", frecuencia: "Diario" },
        { descripcion: "Reemplazar la pastilla PDC con alambre si ha perdido su aroma o está muy reducida en tamaño.", frecuencia: "Semanal" },
        { descripcion: "Reemplazar el tapete antisalpicadura del urinario si está deteriorado o desprende mal olor.", frecuencia: "Semanal" },
        { descripcion: "Limpiar las telas de araña y el polvo acumulado en las esquinas y techos utilizando un escobillón para alcanzar las áreas altas de manera efectiva.", frecuencia: "Semanal" },
        { descripcion: "Lavar las papeleras de basura. Utilizar detergente y agua para lavar tanto el interior como el exterior, asegurándose de eliminar los gérmenes y olores no deseados.", frecuencia: "Semanal" }
    ];


    // Función para generar las filas de la tabla
    function generarTablaActividades(actividades) {
        const tbody = document.querySelector("#tablaActividades tbody");
        tbody.innerHTML = ""; // Limpiar la tabla antes de generar nuevas filas

        actividades.forEach((actividad) => {
            const row = document.createElement("tr");

            // Agregar clase según la frecuencia
            if (actividad.frecuencia === "Diario") {
                row.classList.add("fila-diario");
            } else if (actividad.frecuencia === "Semanal") {
                row.classList.add("fila-semanal");
            }

            row.innerHTML = `
                <td>${actividad.descripcion}</td>
                <td>${actividad.frecuencia}</td>
                <td><input type="checkbox" name="actividad" value="${actividad.descripcion}"></td>
            `;
            tbody.appendChild(row);
        });
    }

    // Función para bloquear los campos del formulario
function bloquearCampos() {
    const campos = [
        'fecha', 'tipo', 'area', 'baño', 'oficina'
    ];
    
    campos.forEach(id => {
        const campo = document.getElementById(id);
        if (campo) {
            campo.disabled = true;
        }
    });
    
    // Mostrar botón Reiniciar (siempre)
    document.getElementById('reiniciarBtn').style.display = 'block';
}

    // Función para reiniciar el formulario (simplificada)
    function reiniciarFormulario() {
        Swal.fire({
            text: "¿Estás seguro de que deseas reiniciar el formulario?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Sí, reiniciar",
            cancelButtonText: "Cancelar",
            customClass: {
                popup: "swal-popup",
                confirmButton: "swal-button",
                cancelButton: "swal-button-cancel",
                actions: "swal-actions",
            },
        }).then((result) => {
            if (result.isConfirmed) {
                // Limpiar el localStorage
                localStorage.removeItem('formData');
                
                // Recargar la página
                location.reload();
            }
        });
    }

    // Función para habilitar o deshabilitar el botón de Enviar
    function actualizarBotonEnviar() {
        const enviarBtn = document.getElementById("enviarBtn");
        enviarBtn.disabled = !verificarCampos();
    }

    // Escuchar cambios en los campos
    document.getElementById("tipo").addEventListener("change", function () {
        mostrarCampos(); // Mostrar u ocultar campos según el tipo
        actualizarBotonEnviar(); // Actualizar el estado del botón
    });

    document.getElementById("area").addEventListener("change", function() {
        const area = this.value;
        const oficinaContainer = document.getElementById("oficinaContainer");
        
        if (area === "Administración") {
            oficinaContainer.style.display = "block";
        } else {
            oficinaContainer.style.display = "none";
            document.getElementById("oficina").value = ""; // Resetear el valor
        }
        
        actualizarBotonEnviar(); // Actualizar el estado del botón
    });

    document.getElementById("baño").addEventListener("change", actualizarBotonEnviar);
    document.getElementById("oficina").addEventListener("change", actualizarBotonEnviar);

    // Escuchar cambios en las actividades
    document.querySelector("#tablaActividades tbody").addEventListener("change", function (e) {
        if (e.target.type === "checkbox") {
            actualizarBotonEnviar(); // Actualizar el estado del botón
        }
    });


    // Función para mostrar u ocultar campos según el tipo de actividad
    function mostrarCampos() {
        const tipo = document.getElementById("tipo").value;
        const areaContainer = document.getElementById("areaContainer");
        const bañoContainer = document.getElementById("bañoContainer");
        const oficinaContainer = document.getElementById("oficinaContainer");
        const tablaContainer = document.getElementById("tablaActividades");

        // Resetear visibilidad
        areaContainer.style.display = "none";
        bañoContainer.style.display = "none";
        oficinaContainer.style.display = "none";
        tablaContainer.style.display = "none"; // Ocultar tabla inicialmente

        if (tipo === "Área") {
            areaContainer.style.display = "block";
        } else if (tipo === "Baño") {
            bañoContainer.style.display = "block";
        }
    }

    // Función para verificar si todos los campos están completos
    function verificarCampos() {
        const tipo = document.getElementById("tipo").value;
        const area = document.getElementById("area").value;
        const baño = document.getElementById("baño").value;
        const oficina = document.getElementById("oficina").value;

        // Verificar el tipo de actividad
        if (tipo === "") {
            return false; // No se ha seleccionado un tipo
        }

        // Verificar si es Área o Baño
        if (tipo === "Área") {
            if (area === "") return false; // No se ha seleccionado un área
            if (area === "Administración" && oficina === "") return false; // Para administración, se requiere oficina
        } else if (tipo === "Baño" && baño === "") {
            return false; // No se ha seleccionado un baño
        }

        return true;
    }

// Función para mostrar los controles de la semana
function mostrarControlesSemana(semanaData) {
  const semanaContainer = document.createElement('div');
  semanaContainer.id = 'semanaContainer';
  semanaContainer.style.margin = '20px 0';
  semanaContainer.style.padding = '15px';
  semanaContainer.style.border = '1px solid #ddd';
  semanaContainer.style.borderRadius = '5px';
  semanaContainer.style.backgroundColor = '#f9f9f9';
  
  // Obtener mes de la fecha seleccionada
  const fechaSeleccionada = document.getElementById('fecha').value;
  const mesSeleccionado = fechaSeleccionada.split('-')[1];
  
  // Contar cuántos días no son del mismo mes
  const diasOtroMes = semanaData.filter(dia => !dia.mismoMes).length;
  
  semanaContainer.innerHTML = `
    <h3 style="margin-top: 0; text-align: center;">Semana del ${formatearFecha(semanaData[0].fecha)} al ${formatearFecha(semanaData[semanaData.length - 1].fecha)}</h3>
    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
      ${semanaData.map((dia, index) => `
        <div style="text-align: center; flex: 1; padding: 5px; 
                    ${!dia.mismoMes ? 'opacity: 0.5; background-color: #f0f0f0;' : ''}
                    ${dia.fecha === fechaSeleccionada ? 'background-color: #e6f7ff; border: 1px solid #007BFF;' : ''}">
          <div style="font-weight: bold;">${['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'][index]}</div>
          <div>${dia.fecha.split('-')[2]}/${dia.fecha.split('-')[1]}</div>
          <div style="font-size: 0.8em; color: ${dia.actividades.length > 0 ? 'green' : 'gray'}">
            ${dia.mismoMes ? (dia.actividades.length > 0 ? '✔' : '✖') : '—'}
          </div>
        </div>
      `).join('')}
    </div>
    <div style="text-align: center;">
      <button id="editarSemanaBtn" type="button" style="padding: 8px 15px; background-color: #007BFF; color: white; border: none; border-radius: 4px; cursor: pointer;">
        Editar semana actual (${7 - diasOtroMes} días)
      </button>
    </div>
    ${diasOtroMes > 0 ? `
      <div style="text-align: center; margin-top: 10px; font-size: 0.8em; color: #666;">
        ${diasOtroMes} día(s) sombreado(s) pertenece(n) a otro mes
      </div>
    ` : ''}
  `;
  
  // Insertar después de la tabla
  const tabla = document.getElementById('tablaActividades');
  tabla.parentNode.insertBefore(semanaContainer, tabla.nextSibling);
  
  // Agregar evento al botón - solo editar días del mismo mes
  document.getElementById('editarSemanaBtn').addEventListener('click', function(e) {
    e.preventDefault();
    mostrarModalSemana(semanaData.filter(dia => dia.mismoMes));
  });
}





// Función para formatear fecha (DD/MM/YYYY)
function formatearFecha(fechaStr) {
  const [year, month, day] = fechaStr.split('-');
  return `${day}/${month}/${year}`;
}

// Función para mostrar el modal de edición semanal
function mostrarModalSemana(semanaData) {

  // Filtrar solo los días del mismo mes
  const mesSeleccionado = document.getElementById('fecha').value.split('-')[1];
  const diasMismoMes = semanaData.filter(dia => dia.fecha.split('-')[1] === mesSeleccionado);


  // Crear el modal
  const modal = document.createElement('div');
  modal.id = 'semanaModal';
  modal.style.position = 'fixed';
  modal.style.top = '0';
  modal.style.left = '0';
  modal.style.width = '100%';
  modal.style.height = '100%';
  modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
  modal.style.display = 'flex';
  modal.style.justifyContent = 'center';
  modal.style.alignItems = 'center';
  modal.style.zIndex = '1000';
  
  // Crear el contenido del modal
  const modalContent = document.createElement('div');
  modalContent.style.backgroundColor = 'white';
  modalContent.style.padding = '20px';
  modalContent.style.borderRadius = '5px';
  modalContent.style.maxWidth = '90%';
  modalContent.style.maxHeight = '90%';
  modalContent.style.display = 'flex';
  modalContent.style.flexDirection = 'column';
  
  modalContent.innerHTML = `
    <h2 style="margin-top: 0; text-align: center;">Editar Semana</h2>
    <div style="flex: 1; overflow: hidden; display: flex; flex-direction: column;">
      <div style="overflow: auto; flex: 1;">
        <table id="semanaModalTable" style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="padding: 8px; border: 1px solid #ddd; background-color: #f4f4f4;">Actividad</th>
              ${semanaData.map(dia => `
                <th style="padding: 8px; border: 1px solid #ddd; background-color: #f4f4f4; text-align: center;">
                  ${['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'][semanaData.indexOf(dia)]}<br>
                  ${dia.fecha.split('-')[2]}
                </th>
              `).join('')}
            </tr>
          </thead>
          <tbody id="semanaModalBody">
            <!-- Las filas se generarán dinámicamente -->
          </tbody>
        </table>
      </div>
    </div>
    <div style="display: flex; justify-content: space-between; margin-top: 15px;">
      <button id="cancelarSemanaBtn" type="button" style="padding: 8px 15px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
        Cancelar
      </button>
      <button id="guardarSemanaBtn" type="button" style="padding: 8px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
        Guardar Cambios
      </button>
    </div>
  `;
  
  modal.appendChild(modalContent);
  document.body.appendChild(modal);
  
  // Generar las filas de actividades con colores
  const actividades = semanaData[0].actividadesLista || [];
  const tbody = document.getElementById('semanaModalBody');
  
  actividades.forEach((actividad, index) => {
    const row = document.createElement('tr');
    
    // Agregar clase según la frecuencia
    if (actividad.frecuencia === "Diario") {
      row.style.backgroundColor = '#A6D5FA'; // Azul pastel
    } else if (actividad.frecuencia === "Semanal") {
      row.style.backgroundColor = '#FFC0CB'; // Rosa pastel
    }
    
    // Celda de actividad
    const actividadCell = document.createElement('td');
    actividadCell.textContent = actividad.descripcion;
    actividadCell.style.padding = '8px';
    actividadCell.style.border = '1px solid #ddd';
    row.appendChild(actividadCell);
    
    // Celdas de checkboxes para cada día
    semanaData.forEach(dia => {
      const cell = document.createElement('td');
      cell.style.padding = '8px';
      cell.style.border = '1px solid #ddd';
      cell.style.textAlign = 'center';
      
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.dataset.fecha = dia.fecha;
      checkbox.dataset.actividad = actividad.descripcion;
      checkbox.checked = dia.actividades.includes(actividad.descripcion);
      checkbox.style.width = '20px';
      checkbox.style.height = '20px';
      checkbox.style.cursor = 'pointer';
      
      cell.appendChild(checkbox);
      row.appendChild(cell);
    });
    
    tbody.appendChild(row);
  });
  
  // Hacer los encabezados fijos
  const table = document.getElementById('semanaModalTable');
  const thead = table.querySelector('thead');
  const tbodyContainer = table.parentElement;
  
  // Calcular el ancho de las columnas
  const firstRow = tbody.querySelector('tr');
  if (firstRow) {
    const cells = firstRow.querySelectorAll('td');
    const headers = thead.querySelectorAll('th');
    
    cells.forEach((cell, index) => {
      if (headers[index]) {
        headers[index].style.width = `${cell.offsetWidth}px`;
        cell.style.width = `${cell.offsetWidth}px`;
      }
    });
  }
  
  // Configurar el scroll con encabezados fijos
  thead.style.position = 'sticky';
  thead.style.top = '0';
  thead.style.zIndex = '10';
  tbodyContainer.style.overflowY = 'auto';
  
  // Eventos de los botones
  document.getElementById('cancelarSemanaBtn').addEventListener('click', function(e) {
    e.preventDefault();
    document.body.removeChild(modal);
  });
  
  document.getElementById('guardarSemanaBtn').addEventListener('click', function(e) {
    e.preventDefault();
    // Recopilar los cambios
    const checkboxes = document.querySelectorAll('#semanaModalBody input[type="checkbox"]');
    const semanaActualizada = JSON.parse(JSON.stringify(semanaData));
    
    checkboxes.forEach(checkbox => {
      const fecha = checkbox.dataset.fecha;
      const actividad = checkbox.dataset.actividad;
      const dia = semanaActualizada.find(d => d.fecha === fecha);
      
      if (checkbox.checked) {
        if (!dia.actividades.includes(actividad)) {
          dia.actividades.push(actividad);
        }
      } else {
        dia.actividades = dia.actividades.filter(a => a !== actividad);
      }
    });
    
    // Guardar los cambios
    guardarCambiosSemana(semanaActualizada);
    document.body.removeChild(modal);
  });
}

// Función para guardar los cambios de la semana
function guardarCambiosSemana(semanaActualizada) {
  // Mostrar confirmación antes de guardar
  Swal.fire({
    text: "¿Estás seguro de guardar los cambios para toda la semana?",
    icon: "question",
    showCancelButton: true,
    confirmButtonText: "Sí, guardar",
    cancelButtonText: "Cancelar",
    customClass: {
      popup: "swal-popup",
      confirmButton: "swal-button",
      cancelButton: "swal-button-cancel",
      actions: "swal-actions",
    },
  }).then((result) => {
    if (result.isConfirmed) {
      const fecha = document.getElementById('fecha').value;
      const tipo = document.getElementById('tipo').value;
      const area = document.getElementById('area').value;
      const baño = document.getElementById('baño').value;
      const oficina = document.getElementById('oficina').value;
      
      // Mostrar overlay de carga
      document.getElementById('overlay').style.display = 'flex';
      
      // Enviar los datos al servidor
      const url = "https://script.google.com/macros/s/AKfycbzsMXfJpI0OPp14uqJ_FRxm012OyWLPhixbgE9AbHpTxoljNI2vXC7T-g4Lm8Qv6CHmSw/exec";
      
      fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({
          fecha: fecha,
          tipo: tipo,
          area: area,
          baño: baño,
          oficina: oficina,
          semana: JSON.stringify(semanaActualizada),
          actividades: JSON.stringify([]),
          accion: "guardarSemana"
        })
      })
      .then(response => response.text())
      .then(response => {
        // Ocultar overlay
        document.getElementById('overlay').style.display = 'none';
        
        if (response === 'Éxito') {
          // LIMPIAR LOCALSTORAGE ANTES DE MOSTRAR EL MENSAJE DE ÉXITO
          localStorage.removeItem('formData');
          
          Swal.fire({
            text: '¡Semana actualizada correctamente!',
            icon: 'success',
            confirmButtonText: 'Aceptar',
            customClass: {
              popup: "swal-popup",
              confirmButton: "swal-button",
              actions: "swal-actions",
            },
          }).then(() => {
            // Recargar la página después de aceptar
            location.reload();
          });
        } else {
          throw new Error(response);
        }
      })
      .catch(error => {
        console.error('Error al guardar la semana:', error);
        document.getElementById('overlay').style.display = 'none';
        Swal.fire({
          text: 'Error al guardar los cambios de la semana',
          icon: 'error',
          confirmButtonText: 'Aceptar'
        });
      });
    }
  });
}


// Función cargarActividades (mejorada con manejo de errores)
async function cargarActividades() {
  if (!verificarCampos()) return;

  const tipo = document.getElementById("tipo").value;
  const actividades = tipo === "Área" ? actividadesArea : actividadesBaño;
  
  // Mostrar overlay de carga
  document.getElementById("overlay").style.display = "flex";

  try {
    // Generar tabla con actividades básicas
    generarTablaActividades(actividades);
    
    // Obtener datos para la consulta
    const fecha = document.getElementById("fecha").value;
    const tipo = document.getElementById("tipo").value;
    const area = document.getElementById("area").value;
    const baño = document.getElementById("baño").value;
    const oficina = document.getElementById("oficina").value;
    
    // Consultar actividades existentes (ahora con datos semanales)
    const response = await fetch("https://script.google.com/macros/s/AKfycbzsMXfJpI0OPp14uqJ_FRxm012OyWLPhixbgE9AbHpTxoljNI2vXC7T-g4Lm8Qv6CHmSw/exec", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: new URLSearchParams({
        fecha: fecha,
        tipo: tipo,
        area: area,
        baño: baño,
        oficina: oficina,
        accion: "consultarSemana"
      })
    });
    
    if (!response.ok) {
      throw new Error("Error en la consulta");
    }
    
    const data = await response.json();
    
    // Verificar si hay error en la respuesta
    if (data.error) {
      console.error("Error del servidor:", data.message);
      return;
    }
    
    // Marcar checkboxes para el día seleccionado
    if (data.actividades && data.actividades.length > 0) {
      data.actividades.forEach(actividad => {
        const checkbox = document.querySelector(`input[name="actividad"][value="${actividad}"]`);
        if (checkbox) {
          checkbox.checked = true;
        }
      });
    }
    
    // Mostrar controles de la semana si hay datos
    if (data.semana && data.semana.length > 0) {
      // Agregar la lista completa de actividades a cada día para el modal de edición
      data.semana.forEach(dia => {
        dia.actividadesLista = actividades;
      });
      
      // Eliminar el contenedor de semana si ya existe
      const existingContainer = document.getElementById('semanaContainer');
      if (existingContainer) {
        existingContainer.remove();
      }
      
      mostrarControlesSemana(data.semana);
    }
    
    // BLOQUEAR CAMPOS SIEMPRE
    bloquearCampos();
    
    // Mostrar tabla
    document.getElementById("tablaActividades").style.display = "table";
    
  } catch (error) {
    console.error("Error al cargar actividades:", error);
    Swal.fire({
      text: "Error al cargar actividades existentes",
      icon: "error",
      confirmButtonText: "Aceptar"
    });
  } finally {
    // Ocultar overlay
    document.getElementById("overlay").style.display = "none";
    actualizarBotonEnviar();
  }
}

    // Modificar los event listeners para llamar a cargarActividades cuando los campos estén completos
    document.getElementById("area").addEventListener("change", function() {
        const area = this.value;
        const oficinaContainer = document.getElementById("oficinaContainer");
        
        if (area === "Administración") {
            oficinaContainer.style.display = "block";
        } else {
            oficinaContainer.style.display = "none";
            document.getElementById("oficina").value = "";
        }
        
        if (verificarCampos()) {
            cargarActividades();
        } else {
            document.getElementById("tablaActividades").style.display = "none";
        }
    });

    document.getElementById("baño").addEventListener("change", function() {
        if (verificarCampos()) {
            cargarActividades();
        } else {
            document.getElementById("tablaActividades").style.display = "none";
        }
    });

    document.getElementById("oficina").addEventListener("change", function() {
        if (verificarCampos()) {
            cargarActividades();
        } else {
            document.getElementById("tablaActividades").style.display = "none";
        }
    });

    // Función para confirmar el envío
    function confirmarEnvio() {
        Swal.fire({
            text: "¿Estás seguro de continuar? 🤔",
            icon: "question",
            showCancelButton: true,
            confirmButtonText: "Sí 🫡",
            cancelButtonText: "No 😬",
            customClass: {
                popup: "swal-popup", // Clase para el modal
                confirmButton: "swal-button", // Clase para el botón de confirmación
                cancelButton: "swal-button-cancel", // Clase para el botón de cancelación
                actions: "swal-actions", // Clase para el contenedor de los botones
            },
        }).then((result) => {
            if (result.isConfirmed) {
                // Mostrar el overlay de "Procesando..."
                document.getElementById("overlay").style.display = "flex";

                const fecha = $('#fecha').val();
                const tipo = $('#tipo').val();
                const area = $('#area').val();
                const baño = $('#baño').val();
                const oficina = $('#oficina').val();
                const actividades = [];

                // Recolectar las actividades marcadas
                $('input[name="actividad"]:checked').each(function() {
                    actividades.push($(this).val());
                });

                // Verificar que se hayan seleccionado actividades
                if (actividades.length === 0) {
                    Swal.fire({
                        text: 'Debes seleccionar al menos una actividad.',
                        icon: 'warning',
                        confirmButtonText: 'Aceptar'
                    });
                    return;
                }

                enviarDatos(fecha, tipo, area, baño, oficina, actividades);
            }
        });
    }

    // Función para enviar datos
function enviarDatos(fecha, tipo, area, baño, oficina, actividades) {
    let url = "https://script.google.com/macros/s/AKfycbzsMXfJpI0OPp14uqJ_FRxm012OyWLPhixbgE9AbHpTxoljNI2vXC7T-g4Lm8Qv6CHmSw/exec";
    let alertaUrl = "https://script.google.com/macros/s/AKfycbyD1cxV7dX7yHG0zUH7ISLexvTFpyFA4xFmmcgD5nk9vQino7EqIlXXOUYRq6Cb-Zhv9A/exec";

    // Enviar los datos usando AJAX
    $.ajax({
        url: url,
        type: "POST",
        data: {
            fecha: fecha,
            tipo: tipo,
            area: area,
            baño: baño,
            oficina: oficina,
            actividades: JSON.stringify(actividades)
        },
        success: function(response) {
            console.log("Respuesta del servidor:", response);

            // Ocultar el overlay de espera
            document.getElementById('overlay').style.display = 'none';

            // Limpiar localStorage después de enviar
            localStorage.removeItem('formData');

            /***** NUEVO MÉTODO PARA ENVIAR ALERTAS *****/
            const img = new Image();
            const params = new URLSearchParams();
            params.append('tipo', tipo);
            
            if (tipo === "Área") {
                params.append('area', area);
                if (area === "Administración" && oficina) {
                    params.append('oficina', oficina);
                }
            } else if (tipo === "Baño") {
                params.append('baño', baño);
            }
            
            img.src = `${alertaUrl}?${params.toString()}`;
            
            // Mostrar éxito después de un breve retraso
            setTimeout(function() {
                Swal.fire({
                    text: "¡Envío exitoso! 🥳🎉",
                    icon: "success",
                    showCancelButton: false,
                    confirmButtonText: "Aceptar",
                    customClass: {
                        content: "swal-content",
                        confirmButton: "swal-button",
                        popup: "swal-popup",
                    },
                }).then(() => {
                    location.reload();
                });
            }, 500);
        },
        error: function(xhr, status, error) {
            console.error("Error al enviar los datos:", xhr.responseText);
            document.getElementById("overlay").style.display = "none";
            Swal.fire({
                text: 'Hubo un problema al enviar los datos. Intenta nuevamente. 😢',
                icon: 'error',
                confirmButtonText: 'Aceptar'
            });
        }
    });
}


    // Función para guardar las respuestas en localStorage
    function guardarRespuestas() {
        const formData = {};

        // Recopilar todos los campos del formulario
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (input.type !== 'file') { // Excluimos los campos de archivo
                formData[input.id] = input.value;
            }
        });

        // Guardar las actividades seleccionadas
        const actividades = [];
        document.querySelectorAll('input[name="actividad"]:checked').forEach(checkbox => {
            actividades.push(checkbox.value);
        });
        formData.actividades = actividades;

        // Guardar en localStorage
        localStorage.setItem('formData', JSON.stringify(formData));
    }

    // Función para cargar las respuestas guardadas
function cargarRespuestas() {
    const savedData = localStorage.getItem('formData');
    if (savedData) {
        const formData = JSON.parse(savedData);

        // Cargar los valores de los campos
        Object.keys(formData).forEach(key => {
            const input = document.getElementById(key);
            if (input) {
                input.value = formData[key];

                // Disparar el evento "change" en los selects para que se muestren/oculten las preguntas dinámicas
                if (input.tagName === 'SELECT') {
                    input.dispatchEvent(new Event('change'));
                }
            }
        });

        // Cargar las actividades seleccionadas
        if (formData.actividades) {
            formData.actividades.forEach(actividad => {
                const checkbox = document.querySelector(`input[name="actividad"][value="${actividad}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
        }

        // Actualizar el estado del botón de Enviar
        actualizarBotonEnviar();
        
        // BLOQUEAR CAMPOS SIEMPRE (cambio principal)
        bloquearCampos();
    }
}

    // Función para preguntar al usuario si desea continuar con las respuestas guardadas
    function preguntarContinuar() {
        const savedData = localStorage.getItem('formData');
        if (savedData) {
            Swal.fire({
                text: "Tienes un progreso guardado. ¿Te gustaría retomarlo?",
                iconHtml: "🫵🏻",
                showCancelButton: true,
                confirmButtonText: "Sí, continuar 😎",
                cancelButtonText: "No, reiniciar 🤓",
                allowOutsideClick: false, // Evita que el modal se cierre al hacer clic fuera
                customClass: {
                    popup: "swal-popup",
                    confirmButton: "swal-button",
                    cancelButton: "swal-button-cancel",
                    actions: "swal-actions",
                    icon: "no-border-icon", // Clase personalizada para el ícono
                },
            }).then((result) => {
                if (result.isConfirmed) {
                    cargarRespuestas(); // Continuar con el progreso guardado
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    // Mostrar segundo mensaje de confirmación
                    Swal.fire({
                        text: "¿Estás seguro de que deseas perder todo tu progreso?",
                        icon: "warning",
                        showCancelButton: true,
                        confirmButtonText: "Sí, reiniciar",
                        cancelButtonText: "No, recuperar progreso",
                        allowOutsideClick: false,
                        customClass: {
                            popup: "swal-popup",
                            confirmButton: "swal-button",
                            cancelButton: "swal-button-cancel",
                            actions: "swal-actions",
                        },
                    }).then((result) => {
                        if (result.isConfirmed) {
                            localStorage.removeItem('formData'); // Eliminar respuestas guardadas
                            location.reload(); // Recargar la página para reiniciar el formulario
                        } else {
                            cargarRespuestas(); // Recuperar el progreso guardado
                        }
                    });
                }
            });
        }
    }

    // Limpiar respuestas guardadas al enviar el formulario
    function limpiarRespuestasGuardadas() {
        localStorage.removeItem('formData');
    }

    // Escuchar cambios en los campos del formulario
    document.querySelectorAll('input, select, textarea').forEach(input => {
        input.addEventListener('input', guardarRespuestas);
        input.addEventListener('change', guardarRespuestas);
    });

    // Escuchar cambios en las actividades
    document.querySelector("#tablaActividades tbody").addEventListener("change", function (e) {
        if (e.target.type === "checkbox") {
            guardarRespuestas(); // Guardar respuestas al cambiar las actividades
            actualizarBotonEnviar(); // Actualizar el estado del botón
        }
    });

    // Llamar a la función al cargar la página
window.onload = function() {
    preguntarContinuar();
    prellenarFechaHora(); // Precargar la fecha actual
    // No necesitamos verificar localStorage aquí porque preguntarContinuar ya lo hace
};

    let backPressCount = 0; // Contador para rastrear el número de veces que se presiona el botón atrás

    // Bloquear el historial al cargar la página
    history.pushState(null, null, document.URL);

    // Escuchar el evento "popstate" (cuando se presiona el botón atrás)
    window.addEventListener("popstate", function (event) {
        if (backPressCount === 0) {
            // Mostrar el mensaje de advertencia cuando se presiona el botón atrás por primera vez
            Swal.fire({
                text: "Si presionas el botón atrás nuevamente, saldrás del formulario.",
                icon: "warning",
                showCancelButton: false, // Eliminamos el botón de cancelar
                confirmButtonText: "Quedarme", // Cambiamos el texto del botón de confirmar
                allowOutsideClick: false, // Evita que el modal se cierre al hacer clic fuera
                customClass: {
                    popup: "swal-popup",
                    confirmButton: "swal-button",
                    actions: "swal-actions",
                    icon: "swal-icon-circle", // Clase personalizada para el ícono
                },
            }).then((result) => {
                if (result.isConfirmed) {
                    // Si el usuario hace clic en "Quedarme", reiniciamos el contador y bloqueamos el historial nuevamente
                    history.pushState(null, null, document.URL);
                    backPressCount = 0; // Reiniciamos el contador
                }
            });

            backPressCount++; // Aumentamos el contador para la siguiente vez
        } else {
            // Si el contador ya es mayor a 0, dejamos que el usuario salga del formulario
            backPressCount = 0; // Reiniciamos el contador
            history.back(); // Dejamos que el usuario salga
        }
    });
</script>

</body>
</html>
