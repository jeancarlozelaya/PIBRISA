<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bit치cora de Actividades Diarias</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* Evita el desplazamiento horizontal y asegura que el body ocupe el 100% del viewport */
        body, html {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden; /* Oculta el desplazamiento horizontal */
        }

        /* Header */
        .header {
            background-color: #007BFF;
            color: white;
            text-align: center;
            padding: 15px;
            width: 100%;
            font-size: 1.5em;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            box-sizing: border-box; /* Asegura que el padding no exceda el ancho */
        }

        /* Contenedor del formulario */
        .container {
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            text-align: center;
            margin: 40px auto;
            grid-row: 2;
            height: auto;
            box-sizing: border-box; /* Incluye el padding en el ancho total */
        }

        h1 {
            text-align: center;
            color: #333;
            margin: 0 0 20px 0; /* Ajusta el margen inferior */
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }

        input[type="date"],
        input[type="time"],
        input[type="text"],
        textarea,
        select,
        #oficina,
        button {
            width: 100%;
            margin-top: 5px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; /* Incluye el padding en el ancho total */
        }

        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            padding: 12px 0;
        }

        button:hover {
            background-color: #0056b3;
        }

        /* Estilo para el bot칩n "Volver al Inicio" */
        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            text-align: center;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.3s;
            position: fixed;
            top: 80px;
            left: 0px;
            z-index: 1001;
            box-sizing: border-box; /* Incluye el padding en el ancho total */
        }

        .back-button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }

        /* Estilo para los contenedores de preguntas */
        .question-container {
            margin-bottom: 20px;
            text-align: left;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            transition: border-color 0.3s;
            box-sizing: border-box; /* Incluye el padding en el ancho total */
        }

        .question-container:hover {
            border-color: #007BFF;
        }

        .question-container input[type="date"],
        .question-container input[type="time"],
        .question-container input[type="text"],
        .question-container textarea,
        .question-container select {
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            width: 100%;
            font-size: 16px;
            background-color: #f9f9f9;
            color: #333;
            transition: border-color 0.3s;
            box-sizing: border-box; /* Incluye el padding en el ancho total */
            margin-top: 5px;
        }

        .question-container input[type="date"]:focus,
        .question-container input[type="time"]:focus,
        .question-container input[type="text"]:focus,
        .question-container textarea:focus,
        .question-container select:focus {
            border-color: #007BFF;
            outline: none;
        }

        /* Estilo del overlay (pantalla bloqueada) */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        #loadingMessage {
            color: white;
            font-size: 24px;
            font-family: 'Times New Roman', Times, serif;
            text-align: center;
            padding: 20px;
        }

        /* Estilo para Mensajes */
        .swal-actions {
            display: flex; /* Coloca los botones en una fila */
            justify-content: center; /* Centra los botones horizontalmente */
            gap: 10px; /* Espacio entre los botones */
            width: 80%; /* Limita el ancho del contenedor al 80% del modal */
            margin: 0 auto; /* Centra el contenedor horizontalmente */
            flex-wrap: nowrap; /* Evita que los botones se apilen en dos filas */
        }

        /* Estilo personalizado para el contenido del mensaje */
        .swal-content {
            font-size: 0.9em;  /* Reduce el tama침o del texto */
            line-height: 1.4;  /* Ajusta el espaciado entre l칤neas */
        }

        .swal2-html-container {
            margin-bottom: 15px;
        }

        /* Estilo personalizado para ambos botones */
        .swal-button,
        .swal-button-cancel {
            flex: 1; /* Hace que ambos botones ocupen el mismo espacio */
            min-width: 120px; /* Ancho m칤nimo para ambos botones */
            padding: 10px 20px; /* Espaciado interno */
            font-size: 14px; /* Tama침o de fuente */
            text-align: center; /* Centra el texto dentro del bot칩n */
            border: none; /* Elimina el borde predeterminado */
            border-radius: 4px; /* Bordes redondeados */
            color: white; /* Texto en blanco */
            transition: background-color 0.3s ease; /* Transici칩n suave para el hover */
        }

    /* Estilo personalizado para el popup/modal */
    .swal-popup {
        width: 300px;  /* Ajusta el ancho m치ximo del modal */
        max-width: 90%;  /* Permite que el modal sea flexible en pantallas peque침as */
    }

        /* Opcional: colores espec칤ficos para cada bot칩n */
        .swal-button {
            background-color: #28a745;  /* Verde para el bot칩n de "S칤" */
            color: white;  /* Texto en blanco */
            border: none;
            border-radius: 4px;
        }

        .swal-button-cancel {
            background-color: #FF6347 ;  /* Rojo para el bot칩n de "No" */
            color: white;  /* Texto oscuro */
            border: none;
            border-radius: 4px;
        }

        .swal2-actions {
            display: flex !important;  /* Asegura que los botones est칠n en una fila */
            justify-content: center;   /* Centra los botones horizontalmente */
            gap: 10px;                 /* Agrega espacio entre los botones */
            flex-wrap: nowrap;         /* Evita que los botones se apilen en dos filas */
        }

        /* Eliminar el borde negro del 칤cono personalizado */
        .swal2-icon.swal2-icon-show {
            background-color: transparent !important; /* Fondo transparente */
        }

        .no-border-icon {
            border: none !important; /* Elimina el borde circular */
            background-color: transparent !important; /* Fondo transparente */
        }

        /* Estilo para Botones, Habilitar/Deshabilitar */
        #enviarBtn {
            background-color: #007bff; /* Color azul */
            color: white;
            border: none;
            cursor: pointer;
            padding: 12px 0;
            font-size: 16px;
            border-radius: 5px;
            transition: background-color 0.3s ease, opacity 0.3s ease;
        }

        /* Estilo para el bot칩n de enviar cuando est치 deshabilitado */
        #enviarBtn:disabled {
            background-color: #ccc; /* Color gris */
            color: #666666; /* Texto gris oscuro */
            cursor: not-allowed; /* Cambia el cursor a "no permitido" */
            opacity: 0.7; /* Reduce la opacidad para dar un aspecto deshabilitado */
        }

        /* Efecto hover solo cuando el bot칩n est치 habilitado */
        #enviarBtn:not(:disabled):hover {
            background-color: #0056b3; /* Color azul m치s oscuro al pasar el mouse */
        }

        /* Estilo para Botones, Misma Linea */
        .botones-container {
            display: flex; /* Hace que los botones est칠n en la misma l칤nea */
            justify-content: space-between; /* Espacio entre los botones */
            gap: 10px; /* Espacio entre los botones */
            margin-top: 20px; /* Margen superior para separar del contenido anterior */
        }

        /* Estilo para los botones dentro del contenedor */
        .botones-container button {
            flex: 1; /* Hace que los botones ocupen el espacio disponible */
            margin: 0; /* Elimina el margen predeterminado */
        }

        /* Estilo para el bot칩n Reiniciar */
        #reiniciarBtn {
            background-color: #6c757d; /* Color gris */
            color: white;
            border: none;
            cursor: pointer;
            padding: 12px 0;
            font-size: 16px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            display: none; /* Oculto por defecto */
        }

        #reiniciarBtn:hover {
            background-color: #5a6268; /* Color gris m치s oscuro al pasar el mouse */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }

/* Centrar los encabezados de la tabla */
#tablaActividades th {
    text-align: center;
}

/* Centrar las celdas de las columnas Frecuencia y Realizada */
#tablaActividades td:nth-child(2),
#tablaActividades td:nth-child(3) {
    text-align: center;
}

/* Centrar los checkboxes en la columna Realizada */
#tablaActividades td:nth-child(3) input[type="checkbox"] {
    margin: 0 auto;
    display: block;
}


/* Color para filas con frecuencia Diario */
.fila-diario {
    background-color: #A6D5FA; /* Azul pastel m치s bonito */
}

/* Color para filas con frecuencia Semanal */
.fila-semanal {
    background-color: #FFC0CB; /* Lila pastel m치s bonito */
}

/* Estilo para la simbolog칤a */
.simbologia {
    margin-bottom: 10px;
    font-size: 14px;
    display: flex;
    gap: 10px;
}

.simbologia div {
    padding: 5px 10px;
    border-radius: 5px;
}

/* Estilo para la simbolog칤a */
.simbologia .diario {
    background-color: #A6D5FA; /* Azul pastel */
}

.simbologia .semanal {
    background-color: #FFC0CB; /* Lila pastel */
}

/* Ocultar la columna de Frecuencia */
#tablaActividades th:nth-child(2),
#tablaActividades td:nth-child(2) {
    display: none;
}

/* Estilo para hacer los checkboxes m치s grandes */
#tablaActividades input[type="checkbox"] {
    width: 20px;       /* Ancho del checkbox */
    height: 20px;      /* Alto del checkbox */
    transform: scale(1.5); /* Escala el checkbox para hacerlo m치s grande */
    margin: 0 auto;    /* Centra el checkbox en la celda */
    display: block;    /* Asegura que el margen auto funcione */
    cursor: pointer;   /* Cambia el cursor al pasar sobre el checkbox */
}

/* Opcional: estilo para cuando el checkbox est치 marcado */
#tablaActividades input[type="checkbox"]:checked {
    background-color: #007BFF; /* Color de fondo cuando est치 marcado */
}

    </style>
</head>
<body>
    <div class="header">
        Pisos Brillantes
    </div>
    <a href="javascript:void(0);" class="back-button" onclick="goBack()">Volver al Inicio</a>
    <div class="container">
        <h1>Bit치cora de Actividades Diarias</h1>
        <div class="form-container">
            <form id="bitacoraForm">
                <div class="question-container">
                    <label for="fecha">Fecha:</label>
                    <input type="date" id="fecha" name="fecha" required>
                </div>

                <div class="question-container">
                    <label for="tipo">Tipo de Actividad:</label>
                    <select id="tipo" name="tipo" required onchange="mostrarCampos()">
                        <option value="">Selecciona una opci칩n</option>
                        <option value="츼rea">츼rea</option>
                        <option value="Ba침o">Ba침o</option>
                    </select>
                </div>

                <div class="question-container" id="areaContainer" style="display: none;">
                    <label for="area">츼rea:</label>
                    <select id="area" name="area">
                        <option value="">Selecciona una opci칩n</option>
                        <option value="Administraci칩n">Administraci칩n</option>
                        <option value="Almac칠n General">Almac칠n General</option>
                        <option value="Bodega de Limpieza">Bodega de Limpieza</option>
                        <option value="Chiminike">Chiminike</option>
                        <option value="Despacho">Despacho</option>
                        <option value="Enfermer칤a">Enfermer칤a</option>
                        <option value="Equipo M칩vil">Equipo M칩vil</option>
                        <option value="Expedici칩n">Expedici칩n</option>
                        <option value="Laboratorio de Calidad">Laboratorio de Calidad</option>
                        <option value="Laboratorio de Concreto">Laboratorio de Concreto</option>
                        <option value="Machaqueo A">Machaqueo A</option>
                        <option value="Posta Principal">Posta Principal</option>
                        <option value="Sala de Control">Sala de Control</option>
                        <option value="Sala de Maternidad">Sala de Maternidad</option>
                        <option value="Sal칩n Vial">Sal칩n Vial</option>
                        <option value="Taller El칠ctrico">Taller El칠ctrico</option>
                    </select>
                </div>

<div class="question-container" id="oficinaContainer" style="display: none;">
    <label for="oficina">Oficina:</label>
    <select id="oficina" name="oficina">
        <option value="">Selecciona una opci칩n</option>
        <option value="Secci칩n #1">Secci칩n #1</option>
        <option value="Secci칩n #2">Secci칩n #2</option>
    </select>
</div>

                <div class="question-container" id="ba침oContainer" style="display: none;">
                    <label for="ba침o">Ba침os de:</label>
                    <select id="ba침o" name="ba침o">
                        <option value="">Selecciona una opci칩n</option>
                        <option value="Admin - Gerencia">Admin - Gerencia</option>
                        <option value="Admin - Hombres">Admin - Hombres</option>
                        <option value="Admin - Mujeres">Admin - Mujeres</option>
                        <option value="Admin - Sala de Reuniones">Admin - Sala de Reuniones</option>
                        <option value="Almacen General">Almacen General</option>
                        <option value="Camerinos Contratistas">Camerinos Contratistas</option>
                        <option value="Camerinos Permanentes">Camerinos Permanentes</option>
                        <option value="Despacho">Despacho</option>
                        <option value="Enfermer칤a">Enfermer칤a</option>
                        <option value="Expedici칩n">Expedici칩n</option>
                        <option value="Laboratorio de Calidad">Laboratorio de Calidad</option>
                        <option value="Laboratorio de Concreto">Laboratorio de Concreto</option>
                        <option value="Machaqueo A">Machaqueo A</option>
                        <option value="Posta Guardias">Posta Guardias</option>
                        <option value="Posta Recepci칩n">Posta Recepci칩n</option>
                        <option value="Sala de Control">Sala de Control</option>
                        <option value="Sal칩n Vial">Sal칩n Vial</option>
                        <option value="Taller Electrico">Taller Electrico</option>
                        <option value="Transportistas">Transportistas</option>
                    </select>
                </div>

                <div class="simbologia">
                    <div class="diario">Diario</div>
                    <div class="semanal">Semanal</div>
                </div>

                <table id="tablaActividades">
                    <thead>
                        <tr>
                            <th>Actividad</th>
                            <th>Frecuencia</th>
                            <th>Realizada</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Las actividades se generar치n autom치ticamente aqu칤 -->
                    </tbody>
                </table>

                <div class="botones-container">
                    <button type="button" id="reiniciarBtn" onclick="reiniciarFormulario()">Reiniciar</button>
                    <button type="button" id="enviarBtn" disabled onclick="confirmarEnvio()">Enviar</button>
                </div>
            </form>

            <!-- Contenedor para bloquear la pantalla -->
            <div id="overlay" style="display: none;">
                <div id="loadingMessage">
                    <p>Procesando...游봄</p>
                </div>
            </div>
        </div>
    </div>

<script>
    // Funci칩n para volver al inicio
    function goBack() {
        window.location.href = "Bit치coras.html";
    }

    // Precargar la fecha actual
    function prellenarFechaHora() {
        let today = new Date();
        let year = today.getFullYear();
        let month = String(today.getMonth() + 1).padStart(2, "0");
        let day = String(today.getDate()).padStart(2, "0");
        document.getElementById("fecha").value = `${year}-${month}-${day}`;
    }

    // Llamar a la funci칩n para precargar la fecha al cargar la p치gina
    prellenarFechaHora();

    // Arreglo COMPLETO de actividades para 츼reas (sin omitir ninguna)
    const actividadesArea = [
        { descripcion: "Sacudir o aspirar el polvo de los muebles y las estanter칤as en las 치reas designadas.", frecuencia: "Diario" },
        { descripcion: "Limpiar y desinfectar todas las superficies de trabajo, incluyendo escritorios, mesas, estantes, archiveros y mostradores.", frecuencia: "Diario" },
        { descripcion: "Limpiar y desinfectar los tel칠fonos, teclados, mouse y otros dispositivos electr칩nicos compartidos.", frecuencia: "Diario" },
        { descripcion: "Limpiar y desinfectar todas las superficies de contacto frecuente, como manijas de puertas, interruptores de luz y pasamanos.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfeccion de los oasis. Limpiar toda la superficie exterior con un pa침o desinfectante o toallitas adecuadas para eliminar g칠rmenes y mantener un entorno de trabajo saludable.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfeccion de los microondas. Limpiar la superficie exterior e interior, con un pa침o desinfectante o toallitas adecuadas para eliminar g칠rmenes y mantener un entorno de trabajo saludable.", frecuencia: "Diario" },
        { descripcion: "Limpieza y lavado de las percoladoras, desmontar las piezas removibles y lavarlas con agua y jab칩n, asegur치ndose de enjuagarlas bien. Limpia la superficie exterior con un pa침o desinfectante para mantener la higiene.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfecci칩n de las refrigeradoras, limpiar tanto por dentro como por fuera, incluyendo estantes y cajones, usando un pa침o desinfectante para mantener un entorno seguro para los alimentos.", frecuencia: "Diario" },
        { descripcion: "Barrer o mopear el suelo en toda el 치rea designada para eliminar el polvo y la suciedad.", frecuencia: "Diario" },
        { descripcion: "Recolectar la basura de todos los basureros, asegurandose de reemplazar las bolsas de basura por nuevas.", frecuencia: "Diario" },
        { descripcion: "Reponer los suministros de papel higi칠nico, toallas de papel, jab칩n y otros suministros necesarios.", frecuencia: "Diario" },
        { descripcion: "Trapear el suelo en toda el 치rea designada utilizando desinfectante, asegurando una limpieza m치s profunda y desinfecci칩n.", frecuencia: "Diario" },
        { descripcion: "Aplicar un aromatizante en el 치rea designada despu칠s de haber terminado la limpieza para mantener un ambiente fresco y agradable.", frecuencia: "Diario" },
        { descripcion: "Limpiar las telas de ara침a y el polvo acumulado en las esquinas y techos utilizando un escobill칩n para alcanzar las 치reas altas de manera efectiva.", frecuencia: "Semanal" },
        { descripcion: "Realizar un lavado profundo del oasis, de esta manera garantizar la calidad del agua que se dispensa y mantener el funcionamiento 칩ptimo del equipo.", frecuencia: "Semanal" },
        { descripcion: "Eliminar las part칤culas de polvo en los diferentes vidrios con un pa침o de microfibra color caf칠. Aplicar limpiador de vidrio con un pa침o de microfibra azul para obtener un acabado brillante y sin rayas.", frecuencia: "Semanal" },
        { descripcion: "Limpiar y aplicar abrillantador en las patas de las sillas usando un pa침o de microfibra color cafe para eliminar la suciedad y el polvo acumulado, y de esta manera dejarlas con un acabado brillante.", frecuencia: "Semanal" },
        { descripcion: "Lavar las piletas de alrededores de las 치reas.", frecuencia: "Semanal" },
        { descripcion: "Lavar las papeleras de basura de las oficinas. Utilizar detergente y agua para lavar tanto el interior como el exterior de las papeleras, asegur치ndose de eliminar los g칠rmenes y olores no deseados.", frecuencia: "Semanal" }
    ];

    // Arreglo COMPLETO de actividades para Ba침os (sin omitir ninguna)
    const actividadesBa침o = [
        { descripcion: "Recolectar la basura de todos los basureros, asegur치ndose de reemplazar las bolsas de basura por nuevas.", frecuencia: "Diario" },
        { descripcion: "Barrer o mopear el suelo en toda el 치rea designada para eliminar el polvo y la suciedad.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfecci칩n de los urinarios presentes.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfecci칩n de los sanitarios presentes.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfecci칩n de las duchas presentes.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfecci칩n de los lavamanos presentes.", frecuencia: "Diario" },
        { descripcion: "Revisar que no haya da침os o problemas de funcionamiento en los ba침os, y en caso que aplique reportar al supervisor.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfecci칩n de todas las superficies de contacto frecuente, como manijas de puertas, interruptores de luz y pasamanos.", frecuencia: "Diario" },
        { descripcion: "Limpieza y desinfecci칩n de los recubrimientos como azulejos aplicando una soluci칩n concentrada de cloro al 0.2% y secar con una toalla de microfibra color amarillo.", frecuencia: "Diario" },
        { descripcion: "Aplicar el limpiador y pulidor de acero inoxidable, con una toalla de microfibra color caf칠 en las superficies de acero inoxidable presentes en el 치rea.", frecuencia: "Diario" },
        { descripcion: "Aplicar limpiador de vidrio en los espejos con un pa침o de microfibra color azul para obtener un acabado brillante y sin rayas.", frecuencia: "Diario" },
        { descripcion: "Reponer los suministros de papel higi칠nico, toallas de papel, jab칩n y otros suministros necesarios.", frecuencia: "Diario" },
        { descripcion: "Revisar el estado de funcionamiento de los diferentes dispensadores que est칠n presentes, y en caso de da침o reportar al supervisor.", frecuencia: "Diario" },
        { descripcion: "Trapear el suelo en toda el 치rea designada utilizando desinfectante, asegurando una limpieza m치s profunda y desinfecci칩n.", frecuencia: "Diario" },
        { descripcion: "Aplicar un aromatizante en el 치rea designada despu칠s de haber terminado la limpieza para mantener un ambiente fresco y agradable.", frecuencia: "Diario" },
        { descripcion: "Reemplazar la pastilla PDC con alambre si ha perdido su aroma o est치 muy reducida en tama침o.", frecuencia: "Semanal" },
        { descripcion: "Reemplazar el tapete antisalpicadura del urinario si est치 deteriorado o desprende mal olor.", frecuencia: "Semanal" },
        { descripcion: "Limpiar las telas de ara침a y el polvo acumulado en las esquinas y techos utilizando un escobill칩n para alcanzar las 치reas altas de manera efectiva.", frecuencia: "Semanal" },
        { descripcion: "Lavar las papeleras de basura. Utilizar detergente y agua para lavar tanto el interior como el exterior, asegur치ndose de eliminar los g칠rmenes y olores no deseados.", frecuencia: "Semanal" }
    ];


    // Funci칩n para generar las filas de la tabla
    function generarTablaActividades(actividades) {
        const tbody = document.querySelector("#tablaActividades tbody");
        tbody.innerHTML = ""; // Limpiar la tabla antes de generar nuevas filas

        actividades.forEach((actividad) => {
            const row = document.createElement("tr");

            // Agregar clase seg칰n la frecuencia
            if (actividad.frecuencia === "Diario") {
                row.classList.add("fila-diario");
            } else if (actividad.frecuencia === "Semanal") {
                row.classList.add("fila-semanal");
            }

            row.innerHTML = `
                <td>${actividad.descripcion}</td>
                <td>${actividad.frecuencia}</td>
                <td><input type="checkbox" name="actividad" value="${actividad.descripcion}"></td>
            `;
            tbody.appendChild(row);
        });
    }

    // Funci칩n para bloquear los campos del formulario
function bloquearCampos() {
    const campos = [
        'fecha', 'tipo', 'area', 'ba침o', 'oficina'
    ];
    
    campos.forEach(id => {
        const campo = document.getElementById(id);
        if (campo) {
            campo.disabled = true;
        }
    });
    
    // Mostrar bot칩n Reiniciar (siempre)
    document.getElementById('reiniciarBtn').style.display = 'block';
}

    // Funci칩n para reiniciar el formulario (simplificada)
    function reiniciarFormulario() {
        Swal.fire({
            text: "쮼st치s seguro de que deseas reiniciar el formulario?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "S칤, reiniciar",
            cancelButtonText: "Cancelar",
            customClass: {
                popup: "swal-popup",
                confirmButton: "swal-button",
                cancelButton: "swal-button-cancel",
                actions: "swal-actions",
            },
        }).then((result) => {
            if (result.isConfirmed) {
                // Limpiar el localStorage
                localStorage.removeItem('formData');
                
                // Recargar la p치gina
                location.reload();
            }
        });
    }

    // Funci칩n para habilitar o deshabilitar el bot칩n de Enviar
    function actualizarBotonEnviar() {
        const enviarBtn = document.getElementById("enviarBtn");
        enviarBtn.disabled = !verificarCampos();
    }

    // Escuchar cambios en los campos
    document.getElementById("tipo").addEventListener("change", function () {
        mostrarCampos(); // Mostrar u ocultar campos seg칰n el tipo
        actualizarBotonEnviar(); // Actualizar el estado del bot칩n
    });

    document.getElementById("area").addEventListener("change", function() {
        const area = this.value;
        const oficinaContainer = document.getElementById("oficinaContainer");
        
        if (area === "Administraci칩n") {
            oficinaContainer.style.display = "block";
        } else {
            oficinaContainer.style.display = "none";
            document.getElementById("oficina").value = ""; // Resetear el valor
        }
        
        actualizarBotonEnviar(); // Actualizar el estado del bot칩n
    });

    document.getElementById("ba침o").addEventListener("change", actualizarBotonEnviar);
    document.getElementById("oficina").addEventListener("change", actualizarBotonEnviar);

    // Escuchar cambios en las actividades
    document.querySelector("#tablaActividades tbody").addEventListener("change", function (e) {
        if (e.target.type === "checkbox") {
            actualizarBotonEnviar(); // Actualizar el estado del bot칩n
        }
    });


    // Funci칩n para mostrar u ocultar campos seg칰n el tipo de actividad
    function mostrarCampos() {
        const tipo = document.getElementById("tipo").value;
        const areaContainer = document.getElementById("areaContainer");
        const ba침oContainer = document.getElementById("ba침oContainer");
        const oficinaContainer = document.getElementById("oficinaContainer");
        const tablaContainer = document.getElementById("tablaActividades");

        // Resetear visibilidad
        areaContainer.style.display = "none";
        ba침oContainer.style.display = "none";
        oficinaContainer.style.display = "none";
        tablaContainer.style.display = "none"; // Ocultar tabla inicialmente

        if (tipo === "츼rea") {
            areaContainer.style.display = "block";
        } else if (tipo === "Ba침o") {
            ba침oContainer.style.display = "block";
        }
    }

    // Funci칩n para verificar si todos los campos est치n completos
    function verificarCampos() {
        const tipo = document.getElementById("tipo").value;
        const area = document.getElementById("area").value;
        const ba침o = document.getElementById("ba침o").value;
        const oficina = document.getElementById("oficina").value;

        // Verificar el tipo de actividad
        if (tipo === "") {
            return false; // No se ha seleccionado un tipo
        }

        // Verificar si es 츼rea o Ba침o
        if (tipo === "츼rea") {
            if (area === "") return false; // No se ha seleccionado un 치rea
            if (area === "Administraci칩n" && oficina === "") return false; // Para administraci칩n, se requiere oficina
        } else if (tipo === "Ba침o" && ba침o === "") {
            return false; // No se ha seleccionado un ba침o
        }

        return true;
    }


// Funci칩n para consultar actividades existentes (actualizada)
async function consultarActividadesExistentes(fecha, tipo, area, ba침o, oficina) {
    const url = "https://script.google.com/macros/s/AKfycbzsMXfJpI0OPp14uqJ_FRxm012OyWLPhixbgE9AbHpTxoljNI2vXC7T-g4Lm8Qv6CHmSw/exec";
    
    try {
        const response = await fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
            },
            body: new URLSearchParams({
                fecha: fecha,
                tipo: tipo,
                area: area,
                ba침o: ba침o,
                oficina: oficina,
                accion: "consultar"
            })
        });
        
        if (!response.ok) {
            throw new Error("Error en la consulta");
        }
        
        const data = await response.json();
        
        // Verificar si hay error en la respuesta
        if (data.error) {
            console.error("Error del servidor:", data.message);
            return [];
        }
        
        // Si hay actividades, significa que ese d칤a ya fue marcado
        return data.actividades.length > 0 ? data.actividades : [];
    } catch (error) {
        console.error("Error al consultar actividades:", error);
        return [];
    }
}

    // Funci칩n cargarActividades (mejorada con manejo de errores)
async function cargarActividades() {
    if (!verificarCampos()) return;

    const tipo = document.getElementById("tipo").value;
    const actividades = tipo === "츼rea" ? actividadesArea : actividadesBa침o;
    
    // Mostrar overlay de carga
    document.getElementById("overlay").style.display = "flex";

    try {
        // Generar tabla con actividades b치sicas
        generarTablaActividades(actividades);
        
        // Obtener datos para la consulta
        const fecha = document.getElementById("fecha").value;
        const tipo = document.getElementById("tipo").value;
        const area = document.getElementById("area").value;
        const ba침o = document.getElementById("ba침o").value;
        const oficina = document.getElementById("oficina").value;
        
        // Consultar actividades existentes
        const actividadesExistentes = await consultarActividadesExistentes(fecha, tipo, area, ba침o, oficina);
        
        // Mostrar mensaje si hay error en la consulta
        if (actividadesExistentes === null) {
            Swal.fire({
                text: "Error al consultar actividades existentes",
                icon: "error",
                confirmButtonText: "Aceptar"
            });
            return;
        }
        
        // Marcar checkboxes si hay actividades existentes
        if (actividadesExistentes.length > 0) {
            actividadesExistentes.forEach(actividad => {
                const checkbox = document.querySelector(`input[name="actividad"][value="${actividad}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
        }
        
        // BLOQUEAR CAMPOS SIEMPRE (cambio principal)
        bloquearCampos();
        
        // Mostrar tabla
        document.getElementById("tablaActividades").style.display = "table";
        
    } catch (error) {
        console.error("Error al cargar actividades:", error);
        Swal.fire({
            text: "Error al cargar actividades existentes",
            icon: "error",
            confirmButtonText: "Aceptar"
        });
    } finally {
        // Ocultar overlay
        document.getElementById("overlay").style.display = "none";
        actualizarBotonEnviar();
    }
}


    // Modificar los event listeners para llamar a cargarActividades cuando los campos est칠n completos
    document.getElementById("area").addEventListener("change", function() {
        const area = this.value;
        const oficinaContainer = document.getElementById("oficinaContainer");
        
        if (area === "Administraci칩n") {
            oficinaContainer.style.display = "block";
        } else {
            oficinaContainer.style.display = "none";
            document.getElementById("oficina").value = "";
        }
        
        if (verificarCampos()) {
            cargarActividades();
        } else {
            document.getElementById("tablaActividades").style.display = "none";
        }
    });

    document.getElementById("ba침o").addEventListener("change", function() {
        if (verificarCampos()) {
            cargarActividades();
        } else {
            document.getElementById("tablaActividades").style.display = "none";
        }
    });

    document.getElementById("oficina").addEventListener("change", function() {
        if (verificarCampos()) {
            cargarActividades();
        } else {
            document.getElementById("tablaActividades").style.display = "none";
        }
    });

    // Funci칩n para confirmar el env칤o
    function confirmarEnvio() {
        Swal.fire({
            text: "쮼st치s seguro de continuar? 游뱂",
            icon: "question",
            showCancelButton: true,
            confirmButtonText: "S칤 游삐",
            cancelButtonText: "No 游땳",
            customClass: {
                popup: "swal-popup", // Clase para el modal
                confirmButton: "swal-button", // Clase para el bot칩n de confirmaci칩n
                cancelButton: "swal-button-cancel", // Clase para el bot칩n de cancelaci칩n
                actions: "swal-actions", // Clase para el contenedor de los botones
            },
        }).then((result) => {
            if (result.isConfirmed) {
                // Mostrar el overlay de "Procesando..."
                document.getElementById("overlay").style.display = "flex";

                const fecha = $('#fecha').val();
                const tipo = $('#tipo').val();
                const area = $('#area').val();
                const ba침o = $('#ba침o').val();
                const oficina = $('#oficina').val();
                const actividades = [];

                // Recolectar las actividades marcadas
                $('input[name="actividad"]:checked').each(function() {
                    actividades.push($(this).val());
                });

                // Verificar que se hayan seleccionado actividades
                if (actividades.length === 0) {
                    Swal.fire({
                        text: 'Debes seleccionar al menos una actividad.',
                        icon: 'warning',
                        confirmButtonText: 'Aceptar'
                    });
                    return;
                }

                enviarDatos(fecha, tipo, area, ba침o, oficina, actividades);
            }
        });
    }

    // Funci칩n para enviar datos
    function enviarDatos(fecha, tipo, area, ba침o, oficina, actividades) {
        let url = "https://script.google.com/macros/s/AKfycbzsMXfJpI0OPp14uqJ_FRxm012OyWLPhixbgE9AbHpTxoljNI2vXC7T-g4Lm8Qv6CHmSw/exec"; // SCRIPT DE ENVIOS
        let alertaUrl = "https://script.google.com/macros/s/AKfycbyD1cxV7dX7yHG0zUH7ISLexvTFpyFA4xFmmcgD5nk9vQino7EqIlXXOUYRq6Cb-Zhv9A/exec"; // SCRIPT DE ALERTAS


        // Enviar los datos usando AJAX
        $.ajax({
            url: url,
            type: "POST",
            data: {
                fecha: fecha,
                tipo: tipo,
                area: area,
                ba침o: ba침o,
                oficina: oficina,
                actividades: JSON.stringify(actividades)
            },
            success: function(response) {
                console.log("Respuesta del servidor:", response);

                // Ocultar el overlay de espera
                document.getElementById('overlay').style.display = 'none';

            /***** NUEVO M칄TODO PARA ENVIAR ALERTAS *****/
            // Soluci칩n definitiva usando imagen invisible (no CORS)
            const img = new Image();
            const params = new URLSearchParams();
            params.append('tipo', tipo);
            
            if (tipo === "츼rea") {
                params.append('area', area);
                if (area === "Administraci칩n" && oficina) {
                    params.append('oficina', oficina);
                }
            } else if (tipo === "Ba침o") {
                params.append('ba침o', ba침o);
            }
            
            img.src = `${alertaUrl}?${params.toString()}`;
            
            // Mostrar 칠xito despu칠s de un breve retraso
            setTimeout(function() {
                Swal.fire({
                    text: "춰Env칤o exitoso! 游봅游꿀",
                    icon: "success",
                    showCancelButton: false,
                    confirmButtonText: "Aceptar",
                    customClass: {
                        content: "swal-content",
                        confirmButton: "swal-button",
                        popup: "swal-popup",
                    },
                }).then(() => {
                    if (typeof limpiarRespuestasGuardadas === 'function') {
                        limpiarRespuestasGuardadas();
                    }
                    location.reload();
                });
            }, 500);
            /***** FIN DEL NUEVO M칄TODO *****/
        },
        error: function(xhr, status, error) {
            console.error("Error al enviar los datos:", xhr.responseText);
            document.getElementById("overlay").style.display = "none";
            Swal.fire({
                text: 'Hubo un problema al enviar los datos. Intenta nuevamente. 游땩',
                icon: 'error',
                confirmButtonText: 'Aceptar'
            });
        }
    });
}

    // Funci칩n para guardar las respuestas en localStorage
    function guardarRespuestas() {
        const formData = {};

        // Recopilar todos los campos del formulario
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (input.type !== 'file') { // Excluimos los campos de archivo
                formData[input.id] = input.value;
            }
        });

        // Guardar las actividades seleccionadas
        const actividades = [];
        document.querySelectorAll('input[name="actividad"]:checked').forEach(checkbox => {
            actividades.push(checkbox.value);
        });
        formData.actividades = actividades;

        // Guardar en localStorage
        localStorage.setItem('formData', JSON.stringify(formData));
    }

    // Funci칩n para cargar las respuestas guardadas
function cargarRespuestas() {
    const savedData = localStorage.getItem('formData');
    if (savedData) {
        const formData = JSON.parse(savedData);

        // Cargar los valores de los campos
        Object.keys(formData).forEach(key => {
            const input = document.getElementById(key);
            if (input) {
                input.value = formData[key];

                // Disparar el evento "change" en los selects para que se muestren/oculten las preguntas din치micas
                if (input.tagName === 'SELECT') {
                    input.dispatchEvent(new Event('change'));
                }
            }
        });

        // Cargar las actividades seleccionadas
        if (formData.actividades) {
            formData.actividades.forEach(actividad => {
                const checkbox = document.querySelector(`input[name="actividad"][value="${actividad}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
        }

        // Actualizar el estado del bot칩n de Enviar
        actualizarBotonEnviar();
        
        // BLOQUEAR CAMPOS SIEMPRE (cambio principal)
        bloquearCampos();
    }
}

    // Funci칩n para preguntar al usuario si desea continuar con las respuestas guardadas
    function preguntarContinuar() {
        const savedData = localStorage.getItem('formData');
        if (savedData) {
            Swal.fire({
                text: "Tienes un progreso guardado. 쯊e gustar칤a retomarlo?",
                iconHtml: "游삣游낕",
                showCancelButton: true,
                confirmButtonText: "S칤, continuar 游땙",
                cancelButtonText: "No, reiniciar 游뱁",
                allowOutsideClick: false, // Evita que el modal se cierre al hacer clic fuera
                customClass: {
                    popup: "swal-popup",
                    confirmButton: "swal-button",
                    cancelButton: "swal-button-cancel",
                    actions: "swal-actions",
                    icon: "no-border-icon", // Clase personalizada para el 칤cono
                },
            }).then((result) => {
                if (result.isConfirmed) {
                    cargarRespuestas(); // Continuar con el progreso guardado
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    // Mostrar segundo mensaje de confirmaci칩n
                    Swal.fire({
                        text: "쮼st치s seguro de que deseas perder todo tu progreso?",
                        icon: "warning",
                        showCancelButton: true,
                        confirmButtonText: "S칤, reiniciar",
                        cancelButtonText: "No, recuperar progreso",
                        allowOutsideClick: false,
                        customClass: {
                            popup: "swal-popup",
                            confirmButton: "swal-button",
                            cancelButton: "swal-button-cancel",
                            actions: "swal-actions",
                        },
                    }).then((result) => {
                        if (result.isConfirmed) {
                            localStorage.removeItem('formData'); // Eliminar respuestas guardadas
                            location.reload(); // Recargar la p치gina para reiniciar el formulario
                        } else {
                            cargarRespuestas(); // Recuperar el progreso guardado
                        }
                    });
                }
            });
        }
    }

    // Limpiar respuestas guardadas al enviar el formulario
    function limpiarRespuestasGuardadas() {
        localStorage.removeItem('formData');
    }

    // Escuchar cambios en los campos del formulario
    document.querySelectorAll('input, select, textarea').forEach(input => {
        input.addEventListener('input', guardarRespuestas);
        input.addEventListener('change', guardarRespuestas);
    });

    // Escuchar cambios en las actividades
    document.querySelector("#tablaActividades tbody").addEventListener("change", function (e) {
        if (e.target.type === "checkbox") {
            guardarRespuestas(); // Guardar respuestas al cambiar las actividades
            actualizarBotonEnviar(); // Actualizar el estado del bot칩n
        }
    });

    // Llamar a la funci칩n al cargar la p치gina
window.onload = function() {
    preguntarContinuar();
    prellenarFechaHora(); // Precargar la fecha actual
    // No necesitamos verificar localStorage aqu칤 porque preguntarContinuar ya lo hace
};

    let backPressCount = 0; // Contador para rastrear el n칰mero de veces que se presiona el bot칩n atr치s

    // Bloquear el historial al cargar la p치gina
    history.pushState(null, null, document.URL);

    // Escuchar el evento "popstate" (cuando se presiona el bot칩n atr치s)
    window.addEventListener("popstate", function (event) {
        if (backPressCount === 0) {
            // Mostrar el mensaje de advertencia cuando se presiona el bot칩n atr치s por primera vez
            Swal.fire({
                text: "Si presionas el bot칩n atr치s nuevamente, saldr치s del formulario.",
                icon: "warning",
                showCancelButton: false, // Eliminamos el bot칩n de cancelar
                confirmButtonText: "Quedarme", // Cambiamos el texto del bot칩n de confirmar
                allowOutsideClick: false, // Evita que el modal se cierre al hacer clic fuera
                customClass: {
                    popup: "swal-popup",
                    confirmButton: "swal-button",
                    actions: "swal-actions",
                    icon: "swal-icon-circle", // Clase personalizada para el 칤cono
                },
            }).then((result) => {
                if (result.isConfirmed) {
                    // Si el usuario hace clic en "Quedarme", reiniciamos el contador y bloqueamos el historial nuevamente
                    history.pushState(null, null, document.URL);
                    backPressCount = 0; // Reiniciamos el contador
                }
            });

            backPressCount++; // Aumentamos el contador para la siguiente vez
        } else {
            // Si el contador ya es mayor a 0, dejamos que el usuario salga del formulario
            backPressCount = 0; // Reiniciamos el contador
            history.back(); // Dejamos que el usuario salga
        }
    });
</script>

</body>
</html>
